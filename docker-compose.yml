version: '3'
services:
  bootnode:
    build: ./bootnode
    command:
      - -nodekey
      - /root/.ethereum/boot.key
      - -v5
      - -addr
      - 172.16.238.10:30301
      - -verbosity
      - "9"
    networks:
      app_net:
        ipv4_address: 172.16.238.10
    volumes:
      - ./data/bootnode:/root/.ethereum
      - ./data/bootnode:/root/logs/
    ports:
      - "30301:30301/udp"
  geth_node:
    image: ethereum/client-go
    networks:
      app_net:
        ipv4_address: 172.16.238.11
    volumes:
      - ./geth-config.json:/etc/geth-config.json
      - ./data/geth_node:/root/.ethereum
    command:
      - --bootnodes
      - enode://587b2d08f486131d6125567d6ef286eff6e213b90d0c9bdfcec395f59abf320b4b0462ef694477c0500b5b75cd52b86c3d5c8259e70a248776477307806c1b7e@172.16.238.10:30301
      - --networkid
      - "8416"
    links:
      - bootnode
  aleth_node:
    build: ./aleth-instrumentation
    networks:
      app_net:
        ipv4_address: 172.16.238.12
    command:
      - --config
      - /etc/aleth-config.json
      - --network-id
      - "8416"
      - --peerset
      - required:enode://587b2d08f486131d6125567d6ef286eff6e213b90d0c9bdfcec395f59abf320b4b0462ef694477c0500b5b75cd52b86c3d5c8259e70a248776477307806c1b7e@172.16.238.10:30301
    volumes:
      - ./aleth-config.json:/etc/aleth-config.json
      - ./data/aleth_node:/root/.ethereum
    links:
      - bootnode

networks:
  app_net:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.16.238.0/24
